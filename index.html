<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Stellarium Web AR</title>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stu.lco.global/virtualsky/virtualsky.js"></script>
    
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background-color: #000; font-family: sans-serif; }
        
        #starmap {
            width: 100vw;
            height: 100vh;
        }

        /* Bot칩n necesario para activar el giroscopio en iPhone/Android */
        #btn-start {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 15px 30px;
            background: rgba(255, 215, 0, 0.8); /* Dorado */
            color: black;
            border: 2px solid white;
            border-radius: 10px;
            font-size: 18px;
            z-index: 100;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
    </style>
</head>
<body>

    <button id="btn-start">游늸 ACTIVAR MODO AR (GIROSCOPIO)</button>

    <div id="starmap"></div>

    <script>
        let planetarium;

        $(document).ready(function() {
            planetarium = $.virtualsky({
                id: 'starmap',
                
                // 1. CONEXI칍N AL SERVIDOR (Esto arregla la pantalla negra)
                host: 'https://stu.lco.global/virtualsky/',
                
                projection: 'stereo',
                fov: 70, 
                live: true, 
                latitude: -0.1807, // Quito (puedes cambiarlo)
                longitude: -78.4678,
                lang: 'es',
                
                // 2. CONFIGURACI칍N VISUAL TIPO STELLARIUM
                showstars: true,
                showplanets: true,
                
                // L칤neas que conectan las estrellas
                constellations: true,
                
                // Las "Formas" o dibujos art칤sticos (Mitos)
                constellationimages: true, 
                
                // Nombres
                constellationlabels: true,
                
                milkyway: true,     
                showgalaxy: true,   
                
                // Est칠tica
                color: 'rgba(255, 255, 255, 0.4)', 
                scalestars: 1.5,
                mouse: true // Permite mover con el dedo tambi칠n
            });
        });

        // 3. L칍GICA DEL GIROSCOPIO (MOVER CELULAR)
        const btn = document.getElementById('btn-start');

        btn.addEventListener('click', function() {
            // Ocultar bot칩n
            btn.style.display = 'none';

            // Solicitar permiso (Requerido para iOS 13+)
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            window.addEventListener('deviceorientation', handleOrientation);
                        } else {
                            alert("Permiso denegado. Tendr치s que mover con el dedo.");
                        }
                    })
                    .catch(console.error);
            } else {
                // Android y otros no requieren permiso expl칤cito a veces
                window.addEventListener('deviceorientation', handleOrientation);
            }
        });

        // Funci칩n matem치tica para convertir el movimiento del celular en coordenadas del mapa
        function handleOrientation(event) {
            if (!planetarium) return;

            // alpha: rotaci칩n alrededor del eje Z (br칰jula 0-360)
            // beta: inclinaci칩n frontal (arriba/abajo)
            var alpha = event.alpha; 
            var beta = event.beta;

            if (alpha !== null && beta !== null) {
                // Ajuste b치sico: Mapeamos la br칰jula (alpha) al Azimut del mapa
                // El +180 o ajustes dependen de c칩mo sostienes el cel
                var newAzimuth = alpha; 
                
                // Mapeamos la inclinaci칩n (beta) a la Altura
                // Beta va de -180 a 180. Necesitamos ajustar para que mirar al frente sea horizonte.
                var newElevation = beta - 90; 

                // Actualizamos la c치mara de VirtualSky
                // Nota: VirtualSky usa funciones internas para redibujar, forzamos el centro
                planetarium.setAzimuth(newAzimuth);
                planetarium.setElevation(Math.abs(newElevation) < 90 ? -newElevation : 0);
            }
        }
    </script>
</body>
</html>
